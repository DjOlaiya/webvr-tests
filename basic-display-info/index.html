<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">

    <title>VRDisplay basic test</title>

  </head>

  <body>
    <h1>VRDisplay basic test</h1>

    <p></p>

    <ul>
    </ul>


  </body>
  <script>
    var list = document.querySelector('ul');
    var info = document.querySelector('p');
    if(navigator.getVRDisplays) {
        reportDisplays();
    } else {
      info.textContent = 'WebVR API not supported by this browser.'
    }

    function reportDisplays() {
      navigator.getVRDisplays().then(function(displays) {
        for(var i = 0; i < displays.length; i++) {
          var cap = displays[i].capabilities;
          // cap is a VRDisplayCapabilities object
          var listItem = document.createElement('li');
          listItem.innerHTML = '<strong>Display ' + (i+1) + '</strong>'
                       + '<br>VR Display ID: ' + displays[i].displayId
                       + '<br>VR Display Name: ' + displays[i].displayName
                       + '<br>Display can present content: ' + cap.canPresent
                       + '<br>Display is separate from the computer\'s main display: ' + cap.hasExternalDisplay
                       + '<br>Display can return position info: ' + cap.hasPosition
                       + '<br>Display can return orientation info: ' + cap.hasOrientation
                       + '<br>Display max layers: ' + cap.maxLayers;
          list.appendChild(listItem);
        }
      });
    }

    // The following event handlers don't seem to work. Display still shows as connected even when unplugged?

    window.addEventListener('vrdisplayconnected', function() {
      info.textContent = 'Display connected.'
      reportDisplays();
    });

    window.addEventListener('vrdisplaydisconnected', function() {
      info.textContent = 'Display disconnected.'
      reportDisplays();
    });

    window.addEventListener('vrdisplayactivate', function() {
      info.textContent = 'Display activated.'
      reportDisplays();
    });

    window.addEventListener('vrdisplaydeactivate', function() {
      info.textContent = 'Display deactivated.'
      reportDisplays();
    });

    window.addEventListener('vrdisplayblur', function() {
      info.textContent = 'Display unfocused.'
      reportDisplays();
    });

    window.addEventListener('vrdisplayfocus', function() {
      info.textContent = 'Display focused.'
      reportDisplays();
    });

    window.addEventListener('vrdisplaypresentchange', function() {
      info.textContent = 'Display presentation status changed.'
      reportDisplays();
    });


  </script>
</html>
